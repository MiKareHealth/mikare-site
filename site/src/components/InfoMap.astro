---
/**
 * InfoMap Component
 *
 * A minimalist "information flow" divider visualizing convergence.
 * Clean strokes only—no glow, no bullseye, no rings.
 * 2-3 flow lines per side + sparse nodes.
 *
 * @prop {"background" | "divider" | "section"} variant - Placement variant
 * @prop {string} class - Additional CSS classes
 */

interface Props {
  variant?: "background" | "divider" | "section";
  class?: string;
}

const {
  variant = "divider",
  class: className,
} = Astro.props;

const classes = [
  "info-map",
  `info-map--${variant}`,
  className,
].filter(Boolean).join(" ");

// Generate unique IDs for gradients
const uid = Math.random().toString(36).slice(2, 9);
---

<div class={classes} aria-hidden="true">
  <svg
    class="info-map__svg"
    viewBox="0 0 800 100"
    preserveAspectRatio="xMidYMid meet"
    fill="none"
    xmlns="http://www.w3.org/2000/svg"
  >
    <defs>
      <!-- Left flow gradient: fades in toward center -->
      <linearGradient id={`im-left-${uid}`} x1="0%" y1="50%" x2="100%" y2="50%">
        <stop offset="0%" stop-color="var(--im-stroke-primary)" stop-opacity="0" />
        <stop offset="40%" stop-color="var(--im-stroke-primary)" stop-opacity="var(--im-line-opacity)" />
        <stop offset="100%" stop-color="var(--im-stroke-primary)" stop-opacity="var(--im-line-opacity)" />
      </linearGradient>

      <!-- Right flow gradient: fades out from center -->
      <linearGradient id={`im-right-${uid}`} x1="0%" y1="50%" x2="100%" y2="50%">
        <stop offset="0%" stop-color="var(--im-stroke-secondary)" stop-opacity="var(--im-line-opacity)" />
        <stop offset="60%" stop-color="var(--im-stroke-secondary)" stop-opacity="var(--im-line-opacity)" />
        <stop offset="100%" stop-color="var(--im-stroke-secondary)" stop-opacity="0" />
      </linearGradient>
    </defs>

    <!-- Left converging lines (3 lines) -->
    <g class="info-map__lines info-map__lines--left">
      <path
        d="M0,20 Q100,28 200,38 Q300,48 400,50"
        stroke={`url(#im-left-${uid})`}
        stroke-width="2"
        stroke-linecap="round"
      />
      <path
        d="M0,50 Q150,50 300,50 T400,50"
        stroke={`url(#im-left-${uid})`}
        stroke-width="2"
        stroke-linecap="round"
      />
      <path
        d="M0,80 Q100,72 200,62 Q300,52 400,50"
        stroke={`url(#im-left-${uid})`}
        stroke-width="2"
        stroke-linecap="round"
      />
      <!-- Additional subtle outer lines -->
      <path
        d="M0,10 Q120,20 260,40 Q340,48 400,50"
        stroke={`url(#im-left-${uid})`}
        stroke-width="1"
        stroke-linecap="round"
        opacity="0.5"
      />
      <path
        d="M0,90 Q120,80 260,60 Q340,52 400,50"
        stroke={`url(#im-left-${uid})`}
        stroke-width="1"
        stroke-linecap="round"
        opacity="0.5"
      />
    </g>

    <!-- Right diverging lines (3 lines) -->
    <g class="info-map__lines info-map__lines--right">
      <path
        d="M400,50 Q500,48 600,38 Q700,28 800,20"
        stroke={`url(#im-right-${uid})`}
        stroke-width="2"
        stroke-linecap="round"
      />
      <path
        d="M400,50 Q550,50 700,50 T800,50"
        stroke={`url(#im-right-${uid})`}
        stroke-width="2"
        stroke-linecap="round"
      />
      <path
        d="M400,50 Q500,52 600,62 Q700,72 800,80"
        stroke={`url(#im-right-${uid})`}
        stroke-width="2"
        stroke-linecap="round"
      />
      <!-- Additional subtle outer lines -->
      <path
        d="M400,50 Q460,48 540,40 Q680,20 800,10"
        stroke={`url(#im-right-${uid})`}
        stroke-width="1"
        stroke-linecap="round"
        opacity="0.5"
      />
      <path
        d="M400,50 Q460,52 540,60 Q680,80 800,90"
        stroke={`url(#im-right-${uid})`}
        stroke-width="1"
        stroke-linecap="round"
        opacity="0.5"
      />
    </g>

    <!-- Nodes along the paths -->
    <g class="info-map__nodes">
      <!-- Left side nodes -->
      <circle cx="60" cy="32" r="3" class="info-map__node info-map__node--primary" />
      <circle cx="140" cy="42" r="2.5" class="info-map__node info-map__node--secondary" />
      <circle cx="100" cy="68" r="2" class="info-map__node info-map__node--secondary" />
      <circle cx="200" cy="50" r="2.5" class="info-map__node info-map__node--primary" />

      <!-- Right side nodes -->
      <circle cx="600" cy="50" r="2.5" class="info-map__node info-map__node--primary" />
      <circle cx="660" cy="42" r="2.5" class="info-map__node info-map__node--secondary" />
      <circle cx="700" cy="68" r="2" class="info-map__node info-map__node--secondary" />
      <circle cx="740" cy="32" r="3" class="info-map__node info-map__node--primary" />

      <!-- Edge accents -->
      <circle cx="40" cy="50" r="2" class="info-map__node info-map__node--primary" />
      <circle cx="760" cy="50" r="2" class="info-map__node info-map__node--primary" />
    </g>
  </svg>
</div>

<style>
  .info-map {
    position: relative;
    pointer-events: none;
    z-index: 0;
    /* Padding prevents stroke clipping at edges */
    padding: 4px 0;
  }

  .info-map__svg {
    display: block;
    width: 100%;
    height: 100%;
  }

  /* ─── Light Mode Defaults ─── */
  /* Stroke colors: magenta primary, teal secondary */
  .info-map {
    --im-stroke-primary: var(--brand-magenta);
    --im-stroke-secondary: var(--brand-teal);
    --im-line-opacity: 0.36;
    --im-node-opacity-primary: 0.42;
    --im-node-opacity-secondary: 0.34;
  }

  /* ─── Dark Mode ─── */
  /* Stroke colors: teal primary (dominant), magenta secondary */
  :global([data-theme="dark"]) .info-map {
    --im-stroke-primary: var(--brand-teal);
    --im-stroke-secondary: var(--brand-magenta);
    --im-line-opacity: 0.32;
    --im-node-opacity-primary: 0.40;
    --im-node-opacity-secondary: 0.30;
  }

  /* ─── Nodes ─── */
  .info-map__node--primary {
    fill: var(--im-stroke-primary);
    fill-opacity: var(--im-node-opacity-primary);
  }

  .info-map__node--secondary {
    fill: var(--im-stroke-secondary);
    fill-opacity: var(--im-node-opacity-secondary);
  }

  /* ─── Divider Variant ─── */
  .info-map--divider {
    width: 100%;
    max-width: 800px;
    height: 80px;
    margin: var(--space-6) auto var(--space-8);
  }

  @media (max-width: 768px) {
    .info-map--divider {
      max-width: 95%;
      height: 60px;
    }
  }

  /* ─── Section Variant (same as divider for consistency) ─── */
  .info-map--section {
    width: 100%;
    max-width: 800px;
    height: 80px;
    margin: var(--space-6) auto var(--space-8);
  }

  @media (max-width: 768px) {
    .info-map--section {
      max-width: 95%;
      height: 60px;
    }
  }

  /* ─── Background Variant ─── */
  .info-map--background {
    position: absolute;
    inset: 0;
    height: 120px;
    top: 50%;
    transform: translateY(-50%);
  }

  /* ─── Subtle hover enhancement ─── */
  .info-map--divider:hover {
    --im-line-opacity: 0.48;
    --im-node-opacity-primary: 0.55;
    --im-node-opacity-secondary: 0.45;
  }

  :global([data-theme="dark"]) .info-map--divider:hover {
    --im-line-opacity: 0.42;
    --im-node-opacity-primary: 0.50;
    --im-node-opacity-secondary: 0.40;
  }

  /* ─── Transitions ─── */
  .info-map__lines path,
  .info-map__node {
    transition: opacity 200ms ease-out, fill-opacity 200ms ease-out;
  }

  /* ─── Reduced Motion ─── */
  @media (prefers-reduced-motion: reduce) {
    .info-map__lines path,
    .info-map__node {
      transition: none;
    }
  }
</style>
